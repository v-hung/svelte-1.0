{"version":3,"file":"_server.ts-000e0e68.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/v1/auth/refresh-token/_server.ts.js"],"sourcesContent":["import { e as error, j as json } from \"../../../../../../chunks/index2.js\";\nimport { PrismaClient } from \"@prisma/client\";\nimport \"bcrypt\";\nimport { v as verifyToken, s as signToken } from \"../../../../../../chunks/jwt.js\";\nimport \"cookie\";\nconst prisma = new PrismaClient();\nconst POST = async ({ cookies, request }) => {\n  const body = await request.json();\n  const refresh_token = body.refresh_token || cookies.get(\"refresh_token\");\n  if (!refresh_token) {\n    throw error(404, \"Refresh token not found\");\n  }\n  const refresh_token_db = await prisma.verificationToken.findFirst({\n    where: {\n      token: refresh_token,\n      expires: {\n        gte: new Date()\n      }\n    }\n  });\n  if (!refresh_token_db) {\n    throw error(403, \"A token is required for authentication\");\n  }\n  const decoded = await verifyToken(refresh_token);\n  const user = await prisma.user.findUnique({\n    where: {\n      id: decoded?.id || \"0\"\n    },\n    select: {\n      id: true,\n      name: true,\n      email: true,\n      image: true\n    }\n  });\n  if (!user) {\n    throw error(404, \"User not exists\");\n  }\n  const token = await signToken(user);\n  return json({\n    user,\n    token,\n    expiresIn: \"1h\"\n  });\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;;AAKA,MAAM,MAAM,GAAG,IAAI,YAAY,EAAE,CAAC;AAC7B,MAAC,IAAI,GAAG,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK;AAC7C,EAAE,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AACpC,EAAE,MAAM,aAAa,GAAG,IAAI,CAAC,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;AAC3E,EAAE,IAAI,CAAC,aAAa,EAAE;AACtB,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,yBAAyB,CAAC,CAAC;AAChD,GAAG;AACH,EAAE,MAAM,gBAAgB,GAAG,MAAM,MAAM,CAAC,iBAAiB,CAAC,SAAS,CAAC;AACpE,IAAI,KAAK,EAAE;AACX,MAAM,KAAK,EAAE,aAAa;AAC1B,MAAM,OAAO,EAAE;AACf,QAAQ,GAAG,EAAE,IAAI,IAAI,EAAE;AACvB,OAAO;AACP,KAAK;AACL,GAAG,CAAC,CAAC;AACL,EAAE,IAAI,CAAC,gBAAgB,EAAE;AACzB,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,wCAAwC,CAAC,CAAC;AAC/D,GAAG;AACH,EAAE,MAAM,OAAO,GAAG,MAAM,WAAW,CAAC,aAAa,CAAC,CAAC;AACnD,EAAE,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;AAC5C,IAAI,KAAK,EAAE;AACX,MAAM,EAAE,EAAE,OAAO,EAAE,EAAE,IAAI,GAAG;AAC5B,KAAK;AACL,IAAI,MAAM,EAAE;AACZ,MAAM,EAAE,EAAE,IAAI;AACd,MAAM,IAAI,EAAE,IAAI;AAChB,MAAM,KAAK,EAAE,IAAI;AACjB,MAAM,KAAK,EAAE,IAAI;AACjB,KAAK;AACL,GAAG,CAAC,CAAC;AACL,EAAE,IAAI,CAAC,IAAI,EAAE;AACb,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,iBAAiB,CAAC,CAAC;AACxC,GAAG;AACH,EAAE,MAAM,KAAK,GAAG,MAAM,SAAS,CAAC,IAAI,CAAC,CAAC;AACtC,EAAE,OAAO,IAAI,CAAC;AACd,IAAI,IAAI;AACR,IAAI,KAAK;AACT,IAAI,SAAS,EAAE,IAAI;AACnB,GAAG,CAAC,CAAC;AACL;;;;"}