{"version":3,"file":"4-8af6e39b.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/auth/login/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/4.js"],"sourcesContent":["import { f as fail, r as redirect } from \"../../../../chunks/index2.js\";\nimport { c as client } from \"../../../../chunks/prismadb.js\";\nimport bcrypt from \"bcrypt\";\nimport { r as removeSpace } from \"../../../../chunks/validator.js\";\nimport { s as signToken } from \"../../../../chunks/jwt.js\";\nconst prerender = false;\nconst load = async ({ locals }) => {\n  if (!locals.session)\n    return null;\n  const user = await client.user.findUnique({\n    where: {\n      id: locals.session?.user?.id\n    },\n    select: {\n      id: true,\n      name: true,\n      email: true,\n      image: true,\n      password: true\n    }\n  });\n  return { user };\n};\nconst actions = {\n  login: async ({ cookies, request, url }) => {\n    const data = await request.formData();\n    let email = removeSpace(data.get(\"email\") || \"\"), password = data.get(\"password\") || \"\", remember = data.get(\"remember\") || false;\n    const user_data = await client.user.findUnique({\n      where: {\n        email\n      },\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        image: true,\n        password: true\n      }\n    });\n    if (!user_data) {\n      return fail(400, { email, error: \"Email not found\" });\n    }\n    if (!await bcrypt.compare(password, user_data.password || \"\")) {\n      return fail(400, { email, error: \"Password is corrected\" });\n    }\n    const user = {\n      id: user_data.id,\n      name: user_data.name,\n      email: user_data.email,\n      image: user_data.image\n    };\n    const token = await signToken(user);\n    const refresh_token = await signToken(user, remember ? \"60d\" : \"1d\");\n    var expires_refresh_token = new Date();\n    expires_refresh_token.setDate(expires_refresh_token.getDate() + (remember ? 60 : 1));\n    await client.verificationToken.create({\n      data: {\n        identifier: user.id,\n        token: refresh_token,\n        expires: expires_refresh_token\n      }\n    });\n    cookies.set(\"token\", token, { path: \"/\", httpOnly: true, maxAge: 3600 });\n    cookies.set(\"refresh_token\", refresh_token, { path: \"/\", httpOnly: true, maxAge: remember ? 2592e3 : 86400 });\n    throw redirect(302, url.searchParams.get(\"redirect_url\") || \"/dashboard\");\n  },\n  register: async (event) => {\n  },\n  logout: async (event) => {\n    const refresh_token = event.cookies.get(\"refresh_token\");\n    await client.verificationToken.deleteMany({\n      where: {\n        token: refresh_token\n      }\n    });\n    event.cookies.delete(\"token\", { path: \"/\" });\n    event.cookies.delete(\"refresh_token\", { path: \"/\" });\n    event.locals.session = null;\n  }\n};\nexport {\n  actions,\n  load,\n  prerender\n};\n","import * as server from '../entries/pages/auth/login/_page.server.ts.js';\n\nexport const index = 4;\nexport const component = async () => (await import('../entries/pages/auth/login/_page.svelte.js')).default;\nexport const file = '_app/immutable/components/pages/auth/login/_page.svelte-7c1f660a.js';\nexport { server };\nexport const imports = [\"_app/immutable/components/pages/auth/login/_page.svelte-7c1f660a.js\",\"_app/immutable/chunks/index-b5eff4e7.js\",\"_app/immutable/chunks/forms-119fef2c.js\",\"_app/immutable/chunks/parse-f0c618df.js\",\"_app/immutable/chunks/singletons-9fb824a4.js\",\"_app/immutable/chunks/navigation-1415e2f5.js\",\"_app/immutable/chunks/svelte-logo-24ddae96.js\"];\nexport const stylesheets = [\"_app/immutable/assets/_page-9f110145.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":";;;;;;;;;AAKA,MAAM,SAAS,GAAG,KAAK,CAAC;AACxB,MAAM,IAAI,GAAG,OAAO,EAAE,MAAM,EAAE,KAAK;AACnC,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO;AACrB,IAAI,OAAO,IAAI,CAAC;AAChB,EAAE,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;AAC5C,IAAI,KAAK,EAAE;AACX,MAAM,EAAE,EAAE,MAAM,CAAC,OAAO,EAAE,IAAI,EAAE,EAAE;AAClC,KAAK;AACL,IAAI,MAAM,EAAE;AACZ,MAAM,EAAE,EAAE,IAAI;AACd,MAAM,IAAI,EAAE,IAAI;AAChB,MAAM,KAAK,EAAE,IAAI;AACjB,MAAM,KAAK,EAAE,IAAI;AACjB,MAAM,QAAQ,EAAE,IAAI;AACpB,KAAK;AACL,GAAG,CAAC,CAAC;AACL,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;AAClB,CAAC,CAAC;AACF,MAAM,OAAO,GAAG;AAChB,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,EAAE,KAAK;AAC9C,IAAI,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,QAAQ,EAAE,CAAC;AAC1C,IAAI,IAAI,KAAK,GAAG,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,EAAE,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,EAAE,EAAE,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,KAAK,CAAC;AACtI,IAAI,MAAM,SAAS,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;AACnD,MAAM,KAAK,EAAE;AACb,QAAQ,KAAK;AACb,OAAO;AACP,MAAM,MAAM,EAAE;AACd,QAAQ,EAAE,EAAE,IAAI;AAChB,QAAQ,IAAI,EAAE,IAAI;AAClB,QAAQ,KAAK,EAAE,IAAI;AACnB,QAAQ,KAAK,EAAE,IAAI;AACnB,QAAQ,QAAQ,EAAE,IAAI;AACtB,OAAO;AACP,KAAK,CAAC,CAAC;AACP,IAAI,IAAI,CAAC,SAAS,EAAE;AACpB,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,iBAAiB,EAAE,CAAC,CAAC;AAC5D,KAAK;AACL,IAAI,IAAI,CAAC,MAAM,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,SAAS,CAAC,QAAQ,IAAI,EAAE,CAAC,EAAE;AACnE,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,uBAAuB,EAAE,CAAC,CAAC;AAClE,KAAK;AACL,IAAI,MAAM,IAAI,GAAG;AACjB,MAAM,EAAE,EAAE,SAAS,CAAC,EAAE;AACtB,MAAM,IAAI,EAAE,SAAS,CAAC,IAAI;AAC1B,MAAM,KAAK,EAAE,SAAS,CAAC,KAAK;AAC5B,MAAM,KAAK,EAAE,SAAS,CAAC,KAAK;AAC5B,KAAK,CAAC;AACN,IAAI,MAAM,KAAK,GAAG,MAAM,SAAS,CAAC,IAAI,CAAC,CAAC;AACxC,IAAI,MAAM,aAAa,GAAG,MAAM,SAAS,CAAC,IAAI,EAAE,QAAQ,GAAG,KAAK,GAAG,IAAI,CAAC,CAAC;AACzE,IAAI,IAAI,qBAAqB,GAAG,IAAI,IAAI,EAAE,CAAC;AAC3C,IAAI,qBAAqB,CAAC,OAAO,CAAC,qBAAqB,CAAC,OAAO,EAAE,IAAI,QAAQ,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;AACzF,IAAI,MAAM,MAAM,CAAC,iBAAiB,CAAC,MAAM,CAAC;AAC1C,MAAM,IAAI,EAAE;AACZ,QAAQ,UAAU,EAAE,IAAI,CAAC,EAAE;AAC3B,QAAQ,KAAK,EAAE,aAAa;AAC5B,QAAQ,OAAO,EAAE,qBAAqB;AACtC,OAAO;AACP,KAAK,CAAC,CAAC;AACP,IAAI,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;AAC7E,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,aAAa,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,GAAG,MAAM,GAAG,KAAK,EAAE,CAAC,CAAC;AAClH,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI,YAAY,CAAC,CAAC;AAC9E,GAAG;AACH,EAAE,QAAQ,EAAE,OAAO,KAAK,KAAK;AAC7B,GAAG;AACH,EAAE,MAAM,EAAE,OAAO,KAAK,KAAK;AAC3B,IAAI,MAAM,aAAa,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;AAC7D,IAAI,MAAM,MAAM,CAAC,iBAAiB,CAAC,UAAU,CAAC;AAC9C,MAAM,KAAK,EAAE;AACb,QAAQ,KAAK,EAAE,aAAa;AAC5B,OAAO;AACP,KAAK,CAAC,CAAC;AACP,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;AACjD,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,eAAe,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAAC;AACzD,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC;AAChC,GAAG;AACH,CAAC;;;;;;;;;AC7EW,MAAC,KAAK,GAAG,EAAE;AACX,MAAC,SAAS,GAAG,YAAY,CAAC,MAAM,OAAO,4BAA6C,CAAC,EAAE,QAAQ;AAC/F,MAAC,IAAI,GAAG,sEAAsE;AAE9E,MAAC,OAAO,GAAG,CAAC,qEAAqE,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,8CAA8C,CAAC,8CAA8C,CAAC,+CAA+C,EAAE;AAC/V,MAAC,WAAW,GAAG,CAAC,0CAA0C,EAAE;AAC5D,MAAC,KAAK,GAAG;;;;"}