{"version":3,"file":"5-dc792c50.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/auth/callback/_provider_/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/5.js"],"sourcesContent":["import { e as error, r as redirect } from \"../../../../../chunks/index2.js\";\nimport { G as GITHUB_ID, a as GITHUB_SECRET } from \"../../../../../chunks/private.js\";\nimport { c as client } from \"../../../../../chunks/prismadb.js\";\nimport { s as signToken } from \"../../../../../chunks/jwt.js\";\nconst prerender = false;\nconst load = async ({ locals, url, params, cookies }) => {\n  if (params.provider == \"github\") {\n    let formData = new FormData();\n    formData.append(\"client_id\", GITHUB_ID);\n    formData.append(\"client_secret\", GITHUB_SECRET);\n    formData.append(\"code\", url.searchParams.get(\"code\"));\n    const res = await fetch(\"https://github.com/login/oauth/access_token\", {\n      method: \"post\",\n      body: formData,\n      headers: {\n        \"Accept\": \"application/json\"\n      }\n    });\n    const result = await res.json();\n    console.log({ result });\n    if (result.error) {\n      throw error(404, result.error);\n    }\n    const account = await getUserGithub(result?.access_token);\n    if (!account)\n      throw error(404, \"Account Not found\");\n    const account_user = await upsertAccountUser({ account, result, provider: params.provider });\n    const token = await signToken(account_user?.user);\n    const refresh_token = await signToken(account_user?.user, \"60d\");\n    var expires_refresh_token = new Date();\n    expires_refresh_token.setDate(expires_refresh_token.getDate() + 60);\n    await client.verificationToken.create({\n      data: {\n        identifier: account_user?.user?.id,\n        token: refresh_token,\n        expires: expires_refresh_token\n      }\n    });\n    cookies.set(\"token\", token, { path: \"/\", httpOnly: true, maxAge: 3600 });\n    cookies.set(\"refresh_token\", refresh_token, { path: \"/\", httpOnly: true, maxAge: 2592e3 });\n    throw redirect(302, url.searchParams.get(\"redirect_url\") || \"/dashboard\");\n  }\n};\nconst getUserGithub = async (access_token) => {\n  return new Promise((res) => {\n    fetch(\"https://api.github.com/user\", {\n      headers: {\n        \"Authorization\": \"Bearer \" + access_token\n      }\n    }).then((res2) => res2.json()).then((result) => res(result)).catch((e) => res(null));\n  });\n};\nconst upsertAccountUser = async ({ account, result, provider }) => {\n  try {\n    const account_user = await client.account.upsert({\n      where: {\n        provider_providerAccountId: {\n          provider,\n          providerAccountId: account?.id.toString()\n        }\n      },\n      update: {},\n      create: {\n        type: \"oauth\",\n        provider,\n        providerAccountId: account?.id.toString(),\n        access_token: result?.access_token,\n        token_type: result?.token_type,\n        scope: result?.scope,\n        user: {\n          create: {\n            email: account?.email,\n            name: account?.name,\n            image: account?.avatar_url\n          }\n        }\n      },\n      include: {\n        user: {\n          select: {\n            id: true,\n            email: true,\n            name: true,\n            image: true\n          }\n        }\n      }\n    });\n    return account_user;\n  } catch (e) {\n    console.log(e);\n    return null;\n  }\n};\nexport {\n  load,\n  prerender\n};\n","import * as server from '../entries/pages/auth/callback/_provider_/_page.server.ts.js';\n\nexport const index = 5;\nexport { server };\nexport const imports = [];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}